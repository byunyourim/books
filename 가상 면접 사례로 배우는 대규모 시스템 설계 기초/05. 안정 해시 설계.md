# 안정 해시 설계 
수평적 규모 확장성을 위해서는 요청 또는 데이터를 서버에 균등하게 나누는 것이 중요하다.  





<br><br>

## 해시 키 재배치 문제
N개의 캐시 서버가 있다고 하자ㅏ.  

이 서버들에 부하를 균등하게 나누는 보편적인 방법은 아래의 해시함수를 사용하는 것이다.
  
**serverIndex = hash(key) % N (N은 서버 개수)**



서버가 4개라고 하면 0~3 사이의 값을 내어 해당 서버 인덱스를 가진다.

<br>

모듈러 연산은 다음 가정 하에 균등하다.

- 서버 풀 크기 고정
- 데이터의 분포가 균등


하지만 서버가 추가되거나 기존 서버가 삭제되면 문제가 생긴다.  


예를 들어 서버가 4개(s0, s1, s2, s3)가 있었는데 s1이 장애가 발생했다고 하자.  
그럼 정상 서버 개수가 3이 되고, 이는 모듈러 연산의 N값이 바뀌게 된다.  
다시 말해서, s0, s2, s3에 요청을 보내던 키 또한 새로 연산된다.    
   
이럴 경우에, 캐시 클라이언트가 소용없게 된다.    
즉 많은 요청에서 대규모 캐시 미스가 발생하는 문제가 발생하게 된다.  
  
이를 해결하는 기술이 안정 해시 기술이다.  


> #### 캐시미스
> 캐시에서 요청한 데이터가 존재하지 않는 경우를 말한다.




<br><br>


## 안정 해시
일관된 해시라고도 불린다. 분산 캐싱을 위해 등장.

### 안정 해시 기술이 해결하려는 문제는?
서버 추가, 삭제에 따른 재배치해야 할 해시 키(데이터) 양을 줄이기 위함.
스케일 아웃에 용이하며, 해시 키 재배치 시, 재배치 키들이 적어지고 균등하게 분포됨.

즉, 해시 테이블 크기 조정이 이루어지면 평균적으로 오직 k/n개의 키만 재배치하는 기술.
k: 키(아이템) 개수
n: 전체 노드 개수



<br>

### 해시 공간과 해시 링


<br>

### 해시 서버


<br>

### 해시 키



<br>

### 서버 조회



<br>

### 서버 추가


<br>

### 서버 제거


<br>

### 기본 구현법의 두 가지 문제



<br>

### 가상 노드



<br>

### 재배치할 키 결정






## 마치며
