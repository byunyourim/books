## 프로세스 생성의 목적
1. 같은 프로그램의 처리를 여러 개의 프로세스가 나눠서 처리하는 경우
   - 웹 서버에 요청이 들어왔을 때 동시에 처리하는 경우
   - fork() 함수 사용
2. 전혀 다른 프로그램을 생성하는 경우
   - bash로부터 각종 프로그램을 새로 생성하는 경우
   - execve() 함수 사용

<br>

## fork() 와 execve()  

### fork()
- '같은 프로그램의 처리를 여러 개의 프로세스가 나눠서 처리한다'
- 실행시 새로운 프로세스가 생성된다.
- fork()함수 실행시 실행한 프로세스와 함께 새로운 프로세스가 1개 생성된다.
- fork()함수를 실행한 프로세스는 부모 프로세스, 새롭게 생성된 프로세스를 자식 프로세스라고 한다.  

##### 프로세스 생성 순서
1. 부모 프로세스의 메모리를 자식 프로세스 메모리 영역에 복사한다.(새로운 메모리 영역 할당)
2. fork() 함수의 리턴 값이 각기 다른 것을 이용하여 부모 프로세스와 자식 프로세스가 서로 다른 코드를 실행하도록 분기한다.

![fork.png](https://github.com/user-attachments/assets/285df307-64a7-4da7-a2a5-72ab7a81be62)

fork() 함수를 리턴(반환)할 때   
부모 프로세스는 **자식 프로세스의 프로세스 ID**, 자식 프로세스는 **0**을 리턴한다.  

이것을 이용해 부모 프로세스와 자식 프로세스의 처리를 나눠서 실행한다.


<br>  

### execve()
- 전혀 다른 프로그램을 생성할 때 execve() 함수를 사용한다.
- 기존 프로세스를 다른 프로세스로 변경하는 방식으로 수행한다.(새로운 메모리 영역 할당이 이루어지지 않음)

##### 프로세스 생성 순서
1. 실행 파일을 읽은 다음 프로세스의 메모리 맵에 필요한 정보를 읽어들인다.
2. 현재 프로세스의 메모리를 새로운 프로세스의 데이터로 덮어쓴다.
3. 새로운 프로세스의 첫 번째 명령부터 실행한다.

![execve](https://github.com/user-attachments/assets/c8c15a11-9a61-49f4-b106-d3f0131c42a3)

##### 실행 파일
- ELF 형식 사용
- 코드 영역, 데이터 영역, 오프셋, 사이즈, 멤모리 맵 시작 주소로 구성
- **readelf** 커맨드를 통해 확인 가능


    
전혀 다른 프로그램을 생성하는 경우 프로세스의 수를 증가시키는 것이 아닌, 기존의 프로세스를 별도의 프로세스로 변경하는 방식이다.



실행 파일을 읽고 프로세스의 메모리 맵에 필요한 정보를 읽어 들인다. 
실행 파일은 프로세스의 실행 중에 사용하는 코드와 데이터 이외에도 다음과 같은 정보가 필요하다.
- 코드를 포한한 데이터 영역의 파일상 오프셋, 사이즈, 메모리 맵 시작 주소
- 코드 외의 변수 등에서의 데이터 영역에 대한 같은 정보
- 최조로 실행할 명령의 메모리 주소

예로 실행할 프로그램ㅁ의 파일이 아래와 같이 구성되어 있다고 가정하자.
![프로그램파일구조.png](https://github.com/user-attachments/assets/00075f0f-2dde-4a94-a1c9-92a8fb4c37b5)
코드 영역과 데이터 영역의 메모리 맵 시작 주소가 필요한 이유는 CPU에서 실행되는 기계 언어는 특정 메모리 주소를 지정해야 하기 때문이다.


![고급언어예시.png](https://github.com/user-attachments/assets/89a86775-86d5-4b7f-ae27-62853ec7330c)

고급 언어로 적힌 위와 같은 코드가 있다고 해보자

위의 고급언어를 기계언어로 바꿔면 메모리 주소를 직접 조작하는 명령으로 변환(컴파일)된다.
![기계언어예시.png](https://github.com/user-attachments/assets/1cdf34bb-7e2d-49df-9f0b-dde8df491839)



읽어들인 정보를 기준으로 프로그램을 매핑한다. 
그리고 엔트리 포인트에서부터 프로그램을 실행하면 완료된다.


### fork and exec
![forkandexec.png](https://github.com/user-attachments/assets/8c960f9a-cc84-4f6f-a24f-4a0d652255ca)
전혀 다른 프로세스를 생성하는 경우 사용되며, 부모가 될 프로세스가 fork()를 통해 자식 프로세스를 생성하고,
자식 프로세스에서 exec()를 실행하는 방식이다.


<br>


## 종료 처리
프로그램 종료는 C언어의 경우 exit() 함수를 호출하면, _exit()시스템 콜이 호출되고 프로세스가 종료된다.  
프로세스에 할당된 메모리를 전부 회수한다.
![프로세스종료.png](https://github.com/user-attachments/assets/a79f818d-aba1-4477-8465-62743cdcfb31)








