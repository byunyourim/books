### 통화 개념 도입  

#### 통화 개념을 어떻게 구현하는지가 아닌 통화 개념을 어떻게 테스트 할지를 생각하자


String을 이용해 처리해보자
```java
public void testCurrency() {
  assertEquals("USD", Money.dollar(1).currency());
  assertEquals("CHF", Money.franc(1).currency());
}
```

<br>

Money에 currency 추상 메서드를 추가한다.
```java
// Money.class
abstract String currency();
```

<br>

하위 클래스에서, 각각 구현해주자
```java
// Franc.class
String currency() {
  return "CHF";
}

// Dollar.class
Dollar.class() {
  return "USD";
}
```

<br>

하지만 위의 방법보다는 통화를 인스턴스 변수에 저장하고, 메서드에서 이를 반환하도록 하는 것이 더 좋다. 
따라서 currency 라는 지역변수를 생성하고, 이를 생성자에서 저장하도록 구현하자.    

```java
public class Dollar {
  private String currency;

  Dollar(int amount) {
    this.amount = amount;
    this.currency = "USD";
  }

  String currency() {
    return currency;
  }
}
```


<br>

Franc도 Dollar 클래스와 유사하게 작업을 하면 코드가 중복된다.   
위의 코드를 Money 클래스로 옮겨 중복을 제거해보자.
```java
public class Money {
  protected String currency;

  String curency() {
    return currency;
  }
}
```

<br>

이제 currency를 설정해주는 코드가 필요하다. 
이것을 생성자로 옮기면 공통 로직을 만들 수 있다. 하지만 생성자는 추가적으로 수정이 필요하다.
```java
public class Franc {
  Franc(int amount, String currency) {
    this.amount = amount;
    this.currency = "CHF":
  }
}
```

<br>

생서자를 만들면 팩토리 메서드와 times 메서드에 컴파일 에러가 발생한다

```java
// Money.class
static Money franc(int amount) {
  return new Franc(amount, null);
}

// Franc.class
Money times(int multiplier) {
  return new Franc(amount * multiplier, null);
}
```


<br>

times를 수정하다보니 팩토리 메서드를 사용하지 않는 것을 확인할 수 있다.  
times를 생성자가 아닌 팩토리 메서드를 호출하도록 수정하자. 그리고 그에 맞게 클래스 생성자도 수정하자
```java
// Franc.class
Money times(int multiplier) {
  return Money.fran(amountt * miultiplier);
}

Franc(int amount, String currency) {
  this.amount = amount;
  this.currency = currency;
}
```

```java
// Money.class
static Money franc(int amount) {
  return new Franc(amount, "CHF");
}
```

<br>

그리고 이제 Dollar 까지 수정하면 하위 클래스의 생성자가 동일해졌으므로 이를 상위 클래스인 Money로 옮길 수 있다.
그리고 하위 클래스에서는 super로 동일한 생성자를 호출하도록 변경하자.
```java
// Money.class
public abstract class Money {
    protected int amount;
    protected String currency;

    Money(int amount, String currency) {
        this.amount = amount;
        this.currency = currency;
    }
    
    static Money dollar(int amount) {
        return new Dollar(amount, "USD");
    }

    static Money franc(int amount) {
        return new Franc(amount, "CHF");
    }

    public boolean equals(Object object) {
        Money money = (Money) object;
        return amount == money.amount && getClass().equals(money.getClass());
    }
}

// Dollar.class
public class Dollar extends Money {
    
    Dollar(int amount, String currency) {
        super(amount, currency);
    }

    Money times(int multiplier) {
        return Money.dollar(amount * multiplier);
    }
}

// Franc.class
public class Franc extends Money {
    
    Franc (int amount, String currency) {
        super(amount, currency);
    }

    Money times(int multiplier) {
        return Money.franc(amount * multiplier);
    }
}
```


times 메서드를 Money클래스로 올리고, 하위 클래스를 제거하기 위한 단계로 나아갔다.


