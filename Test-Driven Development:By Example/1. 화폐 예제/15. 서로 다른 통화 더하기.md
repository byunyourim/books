이제 서로 다른 두 통화를 더하는 일만 남았다. 이제 이 작업의 시초인 5+10𝐶𝐻𝐹=5+10CHF=5 + 10CHF = 10에 대한 테스트를 작성해보자.
```java
@Test
public void testMixedAddition() {
    Expression fiveBucks = Money.dollar(5);
    Expression tenFrancs  = Money.franc(5);
    Bank bank = new Bank();
    bank.addRate("CHF", "USD", 2);
    Money result = bank.reduce(fiveBucks.plus(tenFrancs), "USD");
        
    assertEquals(Money.dollar(10), result);
}
```



<br><br><br>
위와 같이 테스트를 작성하면 컴파일 에러가 발생한다. 우선 컴파일 에러를 잡기 위해 반환값을 Expression에서 Money로 변경하자.
```java
@Test
public void testMixedAddition() {
    Money fiveBucks = Money.dollar(5);
    Money tenFrancs  = Money.franc(5);
    Bank bank = new Bank();
    bank.addRate("CHF", "USD", 2);
    Money result = bank.reduce(fiveBucks.plus(tenFrancs), "USD");
        
    assertEquals(Money.dollar(10), result);
}
```




<br><br><br>
그리고 테스트를 실행하면 10USD 대신 15USD가 나오면서 테스트가 실패한다. 테스트가 실패하는 이유는 Sum.reduce()가 환율을 처리하지 않기 때문으로 분석된다.
그렇기에 Sum의 reduce 함수에서도 환율을 계산하도록 처리하면 다음과 같이 수정해야 한다.

```java
public Money reduce(Bank bank, String to) {
    int amount = augend.reduce(bank, to).amount + addend.reduce(bank, to).amount;
    return new Money(amount, to);
}
```




<br><br><br>
이렇게 수정하면 테스트가 통과하고, 이제 리팩토링을 해야한다. 우선 Sum 클래스와 같이 Money라는 구체 클래스로 구현된 부분은 모두 Expression으로 바꿔줄 수 있다.

```java
public class Sum implements Expression {
    Expression augend;
    Expression addend;

    Sum(Expression augend, Expression addend) {
        this.augend = augend;
        this.addend= addend;
    }
}

```




<br><br><br>
그 외에도 times나 times의 Money를 Expression으로 대체가능하므로 변경해주도록 하자.
```java
public Expression times(int multiplier) {
    return new Money(amount * multiplier, currency);
}

public Expression plus(Expression addend) {
    return new Sum(this, addend);
}
```


<br><br><br>
그러면 이제 테스트 케이스의 Money 부분을 Expression으로 바꾸도록 하자.
```java
public void testMixedAddition() {
    Expression fiveBucks = Money.dollar(5);
    Expression tenFrancs  = Money.franc(10);
    Bank bank = new Bank();
    bank.addRate("CHF", "USD", 2);
    Money result = bank.reduce(fiveBucks.plus(tenFrancs), "USD");

    assertEquals(Money.dollar(10), result);
}

```



<br><br><br>
그러면 Expression에 plus가 존재하지 않는다고 컴파일 에러가 발생한다. 그러므로 Expression에 plus를 추가해주고, 그러면 Money와 Sum에도 이를 구현해야 할 것이다. Money에는 plus가 이미 있으므로, public으로만 설정해주면 된다.

```java
Expression Interface
Expression plus(Expression addend);

Money Class
public Expression plus(Expression addend) {
    return new Sum(this, addend);
}

Sum Class
public Expression plus(Expression addend) {
    return null;
}
```

